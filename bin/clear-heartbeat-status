#!/usr/bin/env python

import click
from sys import exit

from inbox.heartbeat.config import (STATUS_DATABASE,
                                    get_redis_client, _get_redis_client)
from inbox.heartbeat.status import HeartbeatStatusKey


@click.command()
@click.option('--host', '-h', type=str)
@click.option('--port', '-p', type=int, default=6379)
@click.option('--account-id', '-a', type=int, required=True)
def main(host, port, account_id):
    if host:
        client = _get_redis_client(host, port, STATUS_DATABASE)
    else:
        client = get_redis_client(STATUS_DATABASE)
    batch_client = client.pipeline()
    for name in client.scan_iter(HeartbeatStatusKey.all_folders(account_id),
                                 100):
        batch_client.delete(name)
    batch_client.execute()
    return 0


if __name__ == '__main__':
    exit(main())
